name: Tailscale Windows VPS (6h session)

on:
  workflow_dispatch:

jobs:
  connect:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: نصب Tailscale با Winget
        run: |
          winget install --id=Tailscale.Tailscale -e --accept-source-agreements --accept-package-agreements

      - name: ورود به Tailscale
        run: |
          tailscale up --authkey $env:TS_AUTHKEY --hostname github-vps --accept-dns=false
        env:
          TS_AUTHKEY: ${{ secrets.TS_AUTHKEY }}

      - name: نمایش IP و وضعیت
        run: |
          tailscale ip -4
          tailscale status

      - name: نگه داشتن سشن برای 6 ساعت
        run: |
          echo "Keeping session alive for 6 hours..."
          timeout /t 21600